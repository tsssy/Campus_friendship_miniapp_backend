2025-08-04 19:52:14,015 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:52:24,319 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:52:34,884 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:52:45,244 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:52:55,548 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:53:06,055 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:53:16,373 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:53:26,645 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:53:37,055 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:53:47,213 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:53:57,654 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:54:07,964 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:54:18,145 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:54:28,435 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:54:38,745 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:54:49,088 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:54:59,393 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:55:09,569 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 190/190 条消息
2025-08-04 19:55:10,811 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:55:10,811 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 2 条历史记录
2025-08-04 19:55:12,335 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:55:12,335 - AIResponseProcessor - INFO - 消息 191 已添加到用户 266927105 的内存中
2025-08-04 19:55:12,335 - AIResponseProcessor - INFO - 消息 192 已添加到用户 266927105 的内存中
2025-08-04 19:55:12,335 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 191, 192
2025-08-04 19:55:12,335 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:55:12,345 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:55:19,885 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:55:30,103 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:55:40,381 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:55:50,870 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:56:01,305 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:56:11,893 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:56:22,199 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:56:32,409 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:56:42,625 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:56:52,895 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 192/192 条消息
2025-08-04 19:56:54,438 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:56:54,438 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 4 条历史记录
2025-08-04 19:56:56,183 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:56:56,183 - AIResponseProcessor - INFO - 消息 193 已添加到用户 266927105 的内存中
2025-08-04 19:56:56,183 - AIResponseProcessor - INFO - 消息 194 已添加到用户 266927105 的内存中
2025-08-04 19:56:56,183 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 193, 194
2025-08-04 19:56:56,183 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:56:56,188 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:57:03,279 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 194/194 条消息
2025-08-04 19:57:06,247 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:57:06,248 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 6 条历史记录
2025-08-04 19:57:10,185 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:57:10,185 - AIResponseProcessor - INFO - 消息 195 已添加到用户 266927105 的内存中
2025-08-04 19:57:10,185 - AIResponseProcessor - INFO - 消息 196 已添加到用户 266927105 的内存中
2025-08-04 19:57:10,185 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 195, 196
2025-08-04 19:57:10,185 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:57:10,189 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:57:13,784 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 196/196 条消息
2025-08-04 19:57:24,151 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 196/196 条消息
2025-08-04 19:57:34,638 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 196/196 条消息
2025-08-04 19:57:44,930 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 196/196 条消息
2025-08-04 19:57:55,134 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 196/196 条消息
2025-08-04 19:58:01,342 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:58:01,343 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 8 条历史记录
2025-08-04 19:58:02,564 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:58:02,564 - AIResponseProcessor - INFO - 消息 197 已添加到用户 266927105 的内存中
2025-08-04 19:58:02,564 - AIResponseProcessor - INFO - 消息 198 已添加到用户 266927105 的内存中
2025-08-04 19:58:02,564 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 197, 198
2025-08-04 19:58:02,564 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:58:02,573 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:58:05,416 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 198/198 条消息
2025-08-04 19:58:10,867 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:58:10,868 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 10 条历史记录
2025-08-04 19:58:12,139 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:58:12,139 - AIResponseProcessor - INFO - 消息 199 已添加到用户 266927105 的内存中
2025-08-04 19:58:12,140 - AIResponseProcessor - INFO - 消息 200 已添加到用户 266927105 的内存中
2025-08-04 19:58:12,140 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 199, 200
2025-08-04 19:58:12,140 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:58:12,148 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:58:15,784 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 200/200 条消息
2025-08-04 19:58:26,028 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 200/200 条消息
2025-08-04 19:58:32,910 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:58:32,911 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 12 条历史记录
2025-08-04 19:58:34,233 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:58:34,233 - AIResponseProcessor - INFO - 消息 201 已添加到用户 266927105 的内存中
2025-08-04 19:58:34,233 - AIResponseProcessor - INFO - 消息 202 已添加到用户 266927105 的内存中
2025-08-04 19:58:34,233 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 201, 202
2025-08-04 19:58:34,234 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:58:34,245 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:58:36,213 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 202/202 条消息
2025-08-04 19:58:42,825 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:58:42,825 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 14 条历史记录
2025-08-04 19:58:49,469 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:58:49,470 - AIResponseProcessor - INFO - 消息 203 已添加到用户 266927105 的内存中
2025-08-04 19:58:49,470 - AIResponseProcessor - INFO - 消息 204 已添加到用户 266927105 的内存中
2025-08-04 19:58:49,470 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 203, 204
2025-08-04 19:58:49,470 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:58:49,485 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:58:49,670 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 204/204 条消息
2025-08-04 19:58:59,824 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 204/204 条消息
2025-08-04 19:59:10,011 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 204/204 条消息
2025-08-04 19:59:14,368 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:59:14,368 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 16 条历史记录
2025-08-04 19:59:15,201 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:59:15,201 - AIResponseProcessor - INFO - 消息 205 已添加到用户 266927105 的内存中
2025-08-04 19:59:15,201 - AIResponseProcessor - INFO - 消息 206 已添加到用户 266927105 的内存中
2025-08-04 19:59:15,201 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 205, 206
2025-08-04 19:59:15,201 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:59:15,211 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:59:20,228 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 206/206 条消息
2025-08-04 19:59:21,914 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:59:21,915 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 18 条历史记录
2025-08-04 19:59:23,272 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:59:23,273 - AIResponseProcessor - INFO - 消息 207 已添加到用户 266927105 的内存中
2025-08-04 19:59:23,273 - AIResponseProcessor - INFO - 消息 208 已添加到用户 266927105 的内存中
2025-08-04 19:59:23,273 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 207, 208
2025-08-04 19:59:23,273 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:59:23,283 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:59:30,437 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 208/208 条消息
2025-08-04 19:59:32,744 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 19:59:32,745 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 20 条历史记录
2025-08-04 19:59:36,597 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 19:59:36,597 - AIResponseProcessor - INFO - 消息 209 已添加到用户 266927105 的内存中
2025-08-04 19:59:36,598 - AIResponseProcessor - INFO - 消息 210 已添加到用户 266927105 的内存中
2025-08-04 19:59:36,598 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 209, 210
2025-08-04 19:59:36,598 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 19:59:36,600 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 19:59:40,632 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 210/210 条消息
2025-08-04 19:59:50,809 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 210/210 条消息
2025-08-04 20:00:00,858 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 20:00:00,859 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 22 条历史记录
2025-08-04 20:00:01,994 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 20:00:01,994 - AIResponseProcessor - INFO - 消息 211 已添加到用户 266927105 的内存中
2025-08-04 20:00:01,995 - AIResponseProcessor - INFO - 消息 212 已添加到用户 266927105 的内存中
2025-08-04 20:00:01,995 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 211, 212
2025-08-04 20:00:01,995 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 20:00:01,998 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:00:02,345 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 212/212 条消息
2025-08-04 20:00:11,182 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 20:00:11,208 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 24 条历史记录
2025-08-04 20:00:12,727 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 20:00:12,728 - AIResponseProcessor - INFO - 消息 213 已添加到用户 266927105 的内存中
2025-08-04 20:00:12,728 - AIResponseProcessor - INFO - 消息 214 已添加到用户 266927105 的内存中
2025-08-04 20:00:12,728 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 213, 214
2025-08-04 20:00:12,728 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 20:00:12,742 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:00:12,917 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 214/214 条消息
2025-08-04 20:00:20,218 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 20:00:20,218 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 26 条历史记录
2025-08-04 20:00:21,833 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 20:00:21,833 - AIResponseProcessor - INFO - 消息 215 已添加到用户 266927105 的内存中
2025-08-04 20:00:21,833 - AIResponseProcessor - INFO - 消息 216 已添加到用户 266927105 的内存中
2025-08-04 20:00:21,833 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 215, 216
2025-08-04 20:00:21,833 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 20:00:21,841 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:00:23,172 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 216/216 条消息
2025-08-04 20:00:33,390 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 216/216 条消息
2025-08-04 20:00:36,886 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 20:00:36,886 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 28 条历史记录
2025-08-04 20:00:43,448 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 20:00:43,449 - AIResponseProcessor - INFO - 消息 217 已添加到用户 266927105 的内存中
2025-08-04 20:00:43,449 - AIResponseProcessor - INFO - 消息 218 已添加到用户 266927105 的内存中
2025-08-04 20:00:43,449 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 217, 218
2025-08-04 20:00:43,449 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 20:00:43,469 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:00:43,764 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 218/218 条消息
2025-08-04 20:00:54,371 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 218/218 条消息
2025-08-04 20:01:04,645 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 218/218 条消息
2025-08-04 20:01:14,858 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 218/218 条消息
2025-08-04 20:01:25,137 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 218/218 条消息
2025-08-04 20:01:35,558 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 218/218 条消息
2025-08-04 20:01:45,822 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 218/218 条消息
2025-08-04 20:01:47,226 - AIResponseProcessor - INFO - [266927105] 开始从内存中获取对话历史
2025-08-04 20:01:47,226 - AIResponseProcessor - INFO - [266927105] 成功从内存获取到 30 条历史记录
2025-08-04 20:01:48,328 - AIResponseProcessor - INFO - [266927105] 开始保存对话历史到内存和数据库
2025-08-04 20:01:48,329 - AIResponseProcessor - INFO - 消息 219 已添加到用户 266927105 的内存中
2025-08-04 20:01:48,329 - AIResponseProcessor - INFO - 消息 220 已添加到用户 266927105 的内存中
2025-08-04 20:01:48,329 - AIResponseProcessor - INFO - [266927105] 成功更新内存缓存，新增消息IDs: 219, 220
2025-08-04 20:01:48,329 - AIResponseProcessor - INFO - [266927105] 开始异步写入数据库...
2025-08-04 20:01:48,348 - AIResponseProcessor - ERROR - [266927105] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:01:56,304 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 220/220 条消息
2025-08-04 20:02:06,709 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 220/220 条消息
2025-08-04 20:02:17,768 - AIResponseProcessor - INFO - AI聊天数据保存完成: 19/19 个聊天室, 220/220 条消息
2025-08-04 20:02:22,598 - AIResponseProcessor - INFO - [297581214] 开始从内存中获取对话历史
2025-08-04 20:02:22,598 - AIResponseProcessor - INFO - [297581214] 用户 297581214 在内存中没有AI聊天记录
2025-08-04 20:02:22,610 - AIResponseProcessor - INFO - [297581214] 开始从内存中获取对话历史
2025-08-04 20:02:22,610 - AIResponseProcessor - INFO - [297581214] 用户 297581214 在内存中没有AI聊天记录
2025-08-04 20:02:24,149 - AIResponseProcessor - INFO - [297581214] 开始保存对话历史到内存和数据库
2025-08-04 20:02:24,149 - AIResponseProcessor - INFO - 消息 221 已添加到用户 297581214 的内存中
2025-08-04 20:02:24,149 - AIResponseProcessor - INFO - 消息 222 已添加到用户 297581214 的内存中
2025-08-04 20:02:24,149 - AIResponseProcessor - INFO - [297581214] 成功更新内存缓存，新增消息IDs: 221, 222
2025-08-04 20:02:24,152 - AIResponseProcessor - INFO - [297581214] 开始异步写入数据库...
2025-08-04 20:02:24,211 - AIResponseProcessor - ERROR - [297581214] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:02:27,943 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 222/222 条消息
2025-08-04 20:02:38,147 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 222/222 条消息
2025-08-04 20:02:48,394 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 222/222 条消息
2025-08-04 20:02:58,596 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 222/222 条消息
2025-08-04 20:02:58,940 - AIResponseProcessor - INFO - [297581214] 开始从内存中获取对话历史
2025-08-04 20:02:58,940 - AIResponseProcessor - INFO - [297581214] 成功从内存获取到 2 条历史记录
2025-08-04 20:03:00,465 - AIResponseProcessor - INFO - [297581214] 开始保存对话历史到内存和数据库
2025-08-04 20:03:00,466 - AIResponseProcessor - INFO - 消息 223 已添加到用户 297581214 的内存中
2025-08-04 20:03:00,466 - AIResponseProcessor - INFO - 消息 224 已添加到用户 297581214 的内存中
2025-08-04 20:03:00,466 - AIResponseProcessor - INFO - [297581214] 成功更新内存缓存，新增消息IDs: 223, 224
2025-08-04 20:03:00,466 - AIResponseProcessor - INFO - [297581214] 开始异步写入数据库...
2025-08-04 20:03:00,475 - AIResponseProcessor - ERROR - [297581214] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:03:08,858 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 224/224 条消息
2025-08-04 20:03:19,127 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 224/224 条消息
2025-08-04 20:03:25,004 - AIResponseProcessor - INFO - [297581214] 开始从内存中获取对话历史
2025-08-04 20:03:25,004 - AIResponseProcessor - INFO - [297581214] 成功从内存获取到 4 条历史记录
2025-08-04 20:03:26,587 - AIResponseProcessor - INFO - [297581214] 开始保存对话历史到内存和数据库
2025-08-04 20:03:26,587 - AIResponseProcessor - INFO - 消息 225 已添加到用户 297581214 的内存中
2025-08-04 20:03:26,587 - AIResponseProcessor - INFO - 消息 226 已添加到用户 297581214 的内存中
2025-08-04 20:03:26,587 - AIResponseProcessor - INFO - [297581214] 成功更新内存缓存，新增消息IDs: 225, 226
2025-08-04 20:03:26,587 - AIResponseProcessor - INFO - [297581214] 开始异步写入数据库...
2025-08-04 20:03:26,593 - AIResponseProcessor - ERROR - [297581214] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:03:29,316 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 226/226 条消息
2025-08-04 20:03:34,855 - AIResponseProcessor - INFO - [297581214] 开始从内存中获取对话历史
2025-08-04 20:03:34,856 - AIResponseProcessor - INFO - [297581214] 成功从内存获取到 6 条历史记录
2025-08-04 20:03:36,716 - AIResponseProcessor - INFO - [297581214] 开始保存对话历史到内存和数据库
2025-08-04 20:03:36,716 - AIResponseProcessor - INFO - 消息 227 已添加到用户 297581214 的内存中
2025-08-04 20:03:36,716 - AIResponseProcessor - INFO - 消息 228 已添加到用户 297581214 的内存中
2025-08-04 20:03:36,716 - AIResponseProcessor - INFO - [297581214] 成功更新内存缓存，新增消息IDs: 227, 228
2025-08-04 20:03:36,717 - AIResponseProcessor - INFO - [297581214] 开始异步写入数据库...
2025-08-04 20:03:36,726 - AIResponseProcessor - ERROR - [297581214] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:03:39,510 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 228/228 条消息
2025-08-04 20:03:49,744 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 228/228 条消息
2025-08-04 20:03:59,980 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 228/228 条消息
2025-08-04 20:04:02,737 - AIResponseProcessor - INFO - [297581214] 开始从内存中获取对话历史
2025-08-04 20:04:02,737 - AIResponseProcessor - INFO - [297581214] 成功从内存获取到 8 条历史记录
2025-08-04 20:04:06,452 - AIResponseProcessor - INFO - [297581214] 开始保存对话历史到内存和数据库
2025-08-04 20:04:06,452 - AIResponseProcessor - INFO - 消息 229 已添加到用户 297581214 的内存中
2025-08-04 20:04:06,453 - AIResponseProcessor - INFO - 消息 230 已添加到用户 297581214 的内存中
2025-08-04 20:04:06,453 - AIResponseProcessor - INFO - [297581214] 成功更新内存缓存，新增消息IDs: 229, 230
2025-08-04 20:04:06,453 - AIResponseProcessor - INFO - [297581214] 开始异步写入数据库...
2025-08-04 20:04:06,482 - AIResponseProcessor - ERROR - [297581214] 异步写入数据库失败: Database.update_one() got an unexpected keyword argument 'upsert'
Traceback (most recent call last):
  File "/Users/miac/Documents/Projects/WeChat_demo_backend_v0/app/services/https/AIResponseProcessor.py", line 208, in save_conversation_history
    await Database.update_one(
          ^^^^^^^^^^^^^^^^^^^^
TypeError: Database.update_one() got an unexpected keyword argument 'upsert'
2025-08-04 20:04:10,202 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:04:20,442 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:04:30,672 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:04:41,018 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:04:51,243 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:05:01,452 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:05:11,649 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:05:21,870 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:05:32,080 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:05:42,305 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:05:52,502 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:06:02,702 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:06:12,906 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:06:23,147 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:06:33,353 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:06:43,575 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:06:53,785 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:07:04,012 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:07:14,241 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:07:24,445 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:07:34,641 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:07:44,831 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:07:55,105 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:08:05,334 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:08:15,560 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:08:25,757 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:08:35,987 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:08:46,241 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:08:56,665 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:09:06,871 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:09:17,073 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:09:27,441 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:09:37,661 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:09:47,872 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:09:58,215 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:10:08,434 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:10:18,647 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:10:28,901 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:10:39,114 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:10:49,333 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:10:59,771 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:11:10,023 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:11:20,230 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:11:30,469 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:11:42,410 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:11:53,280 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:12:03,496 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:12:13,697 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:12:24,002 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:12:34,233 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:12:44,688 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:12:54,935 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:13:05,155 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:13:15,360 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:13:25,547 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:13:35,756 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:13:46,107 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:13:56,364 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
2025-08-04 20:14:02,675 - AIResponseProcessor - INFO - AI聊天数据保存完成: 20/20 个聊天室, 230/230 条消息
